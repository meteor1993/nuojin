<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>仓库订单列表页</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
<div id="app">
    <!--<el-button type="primary" @click="selectList()">查询</el-button>-->
    <!--<el-button type="primary" @click="openPanel()">新增订单</el-button>-->
    <div style="height: 15px;"></div>
    <el-table
            :data="tableData"
            style="width: 100%">
        <el-table-column
                label="订单号"
                width="240">
            <template slot-scope="scope">
                {{ scope.row.orderNo }}
            </template>
        </el-table-column>
        <el-table-column
                label="产品名称"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.productNo | productFormat }}
            </template>
        </el-table-column>
        <el-table-column
                label="创建时间"
                width="240">
            <template slot-scope="scope">
                <i class="el-icon-time"></i>
                <span style="margin-left: 10px">{{ scope.row.createDate | dateformat }}</span>
            </template>
        </el-table-column>
        <el-table-column
                label="配送地址"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.address }}
            </template>
        </el-table-column>
        <el-table-column
                label="单价"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.price / 100 | moneyFormat }}
            </template>
        </el-table-column>
        <el-table-column
                label="数量"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.number }}
            </template>
        </el-table-column>
        <el-table-column
                label="渠道"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.channel }}
            </template>
        </el-table-column>
        <el-table-column
                label="订单状态"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.status | typeformat }}
            </template>
        </el-table-column>
        <el-table-column
                label="快递单号"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.expressNo }}
            </template>
        </el-table-column>
        <el-table-column
                label="快递公司"
                width="180">
            <template slot-scope="scope">
                {{ scope.row.expressCompany }}
            </template>
        </el-table-column>
        <el-table-column
                label="发货时间"
                width="240">
            <template slot-scope="scope">
                <i class="el-icon-time"></i>
                <span style="margin-left: 10px">{{ scope.row.sendDate | dateformat }}</span>
            </template>
        </el-table-column>
        <el-table-column label="操作" width="180">
            <template slot-scope="scope">
                <!--<el-button-->
                <!--size="mini"-->
                <!--@click="handleEdit(scope.row.id)">编辑</el-button>-->
                <el-button
                        v-if="scope.row.status === '0'"
                        size="mini"
                        type="danger"
                        @click="handleConfirm(scope.row.id)">确认发货</el-button>
            </template>
        </el-table-column>
    </el-table>
    <el-dialog title="添加快递信息" :visible.sync="dialogFormVisible">
        <el-form :model="form">
            <el-form-item label="快递单号" :label-width="formLabelWidth">
                <el-input v-model="form.expressNo"></el-input>
            </el-form-item>
            <el-form-item label="快递公司" :label-width="formLabelWidth">
                <el-input v-model="form.expressCompany"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="confirmOrder()">确 定</el-button>
        </div>
    </el-dialog>
</div>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.staticfile.org/axios/0.19.0-beta.1/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script>
    moment().format();
    new Vue({
        el: '#app',
        filters: {
            dateformat(dataStr, pattern = 'YYYY-MM-DD HH:mm:ss') {
                return moment(dataStr).format(pattern)
            },
            typeformat(dataStr) {
                if (dataStr === '0') {
                    return '创建'
                } else if (dataStr === '1') {
                    return '已发货'
                } else if (dataStr === '2') {
                    return '已退货'
                }
            },
            moneyFormat(val) {
                val = val.toString().replace(/\$|\,/g,'');
                if(isNaN(val)) {
                    val = "0";
                }
                let sign = (val == (val = Math.abs(val)));
                val = Math.floor(val*100+0.50000000001);
                let cents = val%100;
                val = Math.floor(val/100).toString();
                if(cents<10) {
                    cents = "0" + cents
                }
                for (var i = 0; i < Math.floor((val.length-(1+i))/3); i++) {
                    val = val.substring(0,val.length-(4*i+3))+',' + val.substring(val.length-(4*i+3));
                }

                return (((sign)?'':'-') + val + '.' + cents);
            },
            productFormat(val) {
                if (val === '1') {
                    return '标准版'
                } else if (val === '2') {
                    return '星空版'
                }
            }
        },
        data() {
            return {
                dialogFormVisible: false,
                tableData: [],
                form: {
                    expressNo: '',
                    expressCompany: '',
                    id: ''
                },
                formLabelWidth: '120px',
                cityCode: ''
            }
        },
        mounted() {
            this.fetchData();
        },
        methods: {
            fetchData() {
                const data = this.$data;
                axios({
                    method: 'post',
                    url: '/web/offlineOrder/getOfflineOrderList',
                }).then(function (response) {
                    const list = response.data.resultData.list;
                    data.tableData = list;
                    console.log(list)
                });
            },
            handleConfirm(id) {
                this.dialogFormVisible = true;
                this.form.id = id;
            },
            confirmOrder() {
                const that = this;
                axios({
                    method: 'post',
                    url: '/web/offlineOrder/confirmOrder',
                    data: {
                        id: that.form.id,
                        expressNo: that.form.expressNo,
                        expressCompany: that.form.expressCompany
                    }
                }).then(function () {
                    that.$message({
                        type: 'success',
                        message: '订单确认成功!'
                    });
                    that.fetchData();
                    that.dialogFormVisible = false;
                });
            }
        }
    })
</script>
</body>
</html>